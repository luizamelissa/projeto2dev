import{r as B,I as ee,as as sl,a as se,at as il,au as rl,a3 as he,w as a,af as P,k as l,ak as Z,av as ul,aw as xe,ax as dl,ad as Ye,ay as Xe,az as ye,aA as He,aB as je,M as cl,aC as ml,s as pl,H as ge,e as F,N as ce,v as R,f as x,h as D,g as w,L as K,j as o,$ as d,q as $,K as U,t as O,F as J,D as ae,o as m,x as Ue,P as bl,aD as We,O as Ne,R as Ce,y as Oe,G as Ze,Q as Je,n as ze}from"./app-eQbeWD5H.js";import"./constants-Bw-uDUhc.js";import{D as k,a as fl}from"./DatabaseType-mO-SQkME.js";import{b as Se}from"./viewUtil-B7upAtw9.js";import{c as ve}from"./codemirror-BTHjklX7.js";import{E as Ae}from"./index-BmNEnJU1.js";import{E as Ie,a as De}from"./index-VRqMfdzO.js";import{E as el}from"./index-D9z2151g.js";import{E as Le,a as we}from"./index-Cwmhy3qH.js";import{a as Me,E as Be}from"./index-BaerFzpf.js";import{A as Ge}from"./arrayUtil-CKU0aNL-.js";import{E as gl}from"./index-Bv8Gp-yn.js";import{g as vl}from"./getDialect-Bz_DK6gD.js";import{b as ue,E as _l,c as _e,g as Te}from"./wrapper-CpU0l5lg.js";import{S as de}from"./stringBuilder-DUZQE8vS.js";import{l as Tl}from"./common_view_utils-CwIKtBsg.js";import"./index-BOPAf95y.js";import"./_baseIteratee-CPsVIgij.js";import"./isEqual-CLYQoJlu.js";import"./merge-n0rrKiL5.js";import"./_initCloneObject-CEcXreET.js";import"./isArrayLikeObject-CFDQt_XA.js";import"./castArray-7KkzOv2q.js";import"./clone-BIcN8QqB.js";import"./_baseClone-D2nDHxTt.js";import"./index-CloKM7er.js";import"./index-CdJgEYxU.js";import"./_baseFindIndex-D7XfJLKM.js";import"./objectUtil-Z6JRxuBJ.js";function El(s){let e;const t=B(!1),n=ee({...s,originalPosition:"",originalOverflow:"",visible:!1});function r(g){n.text=g}function u(){const g=n.parent,h=A.ns;if(!g.vLoadingAddClassList){let I=g.getAttribute("loading-number");I=Number.parseInt(I)-1,I?g.setAttribute("loading-number",I.toString()):(xe(g,h.bm("parent","relative")),g.removeAttribute("loading-number")),xe(g,h.bm("parent","hidden"))}i(),E.unmount()}function i(){var g,h;(h=(g=A.$el)==null?void 0:g.parentNode)==null||h.removeChild(A.$el)}function f(){var g;s.beforeClose&&!s.beforeClose()||(t.value=!0,clearTimeout(e),e=window.setTimeout(c,400),n.visible=!1,(g=s.closed)==null||g.call(s))}function c(){if(!t.value)return;const g=n.parent;t.value=!1,g.vLoadingAddClassList=void 0,u()}const y=se({name:"ElLoading",setup(g,{expose:h}){const{ns:I,zIndex:b}=rl("loading");return h({ns:I,zIndex:b}),()=>{const v=n.spinner||n.svg,L=he("svg",{class:"circular",viewBox:n.svgViewBox?n.svgViewBox:"0 0 50 50",...v?{innerHTML:v}:{}},[he("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),S=n.text?he("p",{class:I.b("text")},[n.text]):void 0;return he(ul,{name:I.b("fade"),onAfterLeave:c},{default:a(()=>[P(l("div",{style:{backgroundColor:n.background||""},class:[I.b("mask"),n.customClass,n.fullscreen?"is-fullscreen":""]},[he("div",{class:I.b("spinner")},[L,S])]),[[Z,n.visible]])])})}}}),E=sl(y),A=E.mount(document.createElement("div"));return{...il(n),setText:r,removeElLoadingChild:i,close:f,handleAfterLeave:c,vm:A,get $el(){return A.$el}}}let Re;const hl=function(s={}){if(!dl)return;const e=yl(s);if(e.fullscreen&&Re)return Re;const t=El({...e,closed:()=>{var r;(r=e.closed)==null||r.call(e),e.fullscreen&&(Re=void 0)}});Cl(e,e.parent,t),qe(e,e.parent,t),e.parent.vLoadingAddClassList=()=>qe(e,e.parent,t);let n=e.parent.getAttribute("loading-number");return n?n=`${Number.parseInt(n)+1}`:n="1",e.parent.setAttribute("loading-number",n),e.parent.appendChild(t.$el),Ye(()=>t.visible.value=e.visible),e.fullscreen&&(Re=t),t},yl=s=>{var e,t,n,r;let u;return Xe(s.target)?u=(e=document.querySelector(s.target))!=null?e:document.body:u=s.target||document.body,{parent:u===document.body||s.body?document.body:u,background:s.background||"",svg:s.svg||"",svgViewBox:s.svgViewBox||"",spinner:s.spinner||!1,text:s.text||"",fullscreen:u===document.body&&((t=s.fullscreen)!=null?t:!0),lock:(n=s.lock)!=null?n:!1,customClass:s.customClass||"",visible:(r=s.visible)!=null?r:!0,target:u}},Cl=async(s,e,t)=>{const{nextZIndex:n}=t.vm.zIndex||t.vm._.exposed.zIndex,r={};if(s.fullscreen)t.originalPosition.value=ye(document.body,"position"),t.originalOverflow.value=ye(document.body,"overflow"),r.zIndex=n();else if(s.parent===document.body){t.originalPosition.value=ye(document.body,"position"),await Ye();for(const u of["top","left"]){const i=u==="top"?"scrollTop":"scrollLeft";r[u]=`${s.target.getBoundingClientRect()[u]+document.body[i]+document.documentElement[i]-Number.parseInt(ye(document.body,`margin-${u}`),10)}px`}for(const u of["height","width"])r[u]=`${s.target.getBoundingClientRect()[u]}px`}else t.originalPosition.value=ye(e,"position");for(const[u,i]of Object.entries(r))t.$el.style[u]=i},qe=(s,e,t)=>{const n=t.vm.ns||t.vm._.exposed.ns;["absolute","fixed","sticky"].includes(t.originalPosition.value)?xe(e,n.bm("parent","relative")):He(e,n.bm("parent","relative")),s.fullscreen&&s.lock?He(e,n.bm("parent","hidden")):xe(e,n.bm("parent","hidden"))},ke=Symbol("ElLoading"),Qe=(s,e)=>{var t,n,r,u;const i=e.instance,f=g=>je(e.value)?e.value[g]:void 0,c=g=>{const h=Xe(g)&&(i==null?void 0:i[g])||g;return h&&B(h)},y=g=>c(f(g)||s.getAttribute(`element-loading-${ml(g)}`)),E=(t=f("fullscreen"))!=null?t:e.modifiers.fullscreen,A={text:y("text"),svg:y("svg"),svgViewBox:y("svgViewBox"),spinner:y("spinner"),background:y("background"),customClass:y("customClass"),fullscreen:E,target:(n=f("target"))!=null?n:E?void 0:s,body:(r=f("body"))!=null?r:e.modifiers.body,lock:(u=f("lock"))!=null?u:e.modifiers.lock};s[ke]={options:A,instance:hl(A)}},Nl=(s,e)=>{for(const t of Object.keys(e))cl(e[t])&&(e[t].value=s[t])},Ee={mounted(s,e){e.value&&Qe(s,e)},updated(s,e){const t=s[ke];e.oldValue!==e.value&&(e.value&&!e.oldValue?Qe(s,e):e.value&&e.oldValue?je(e.value)&&Nl(e.value,t.options):t==null||t.instance.close())},unmounted(s){var e;(e=s[ke])==null||e.instance.close(),s[ke]=null}},me=pl("design",{state:()=>({schema:"",table:"",columns:[],tableMeta:{},dbType:k.MYSQL,dialect:null,remainHeight:0,activePanel:"column"}),getters:{canAlterTable(s){var e;try{return(e=s.dialect)==null?void 0:e.updateColumn({oldRow:{}})}catch(t){return console.error("canAlterTable",t),!0}},supportForeignKey(s){var e;return(e=s.dialect)==null?void 0:e.showForeignKeys()},supportCheck(s){var e;return(e=s.dialect)==null?void 0:e.showChecks()},supportTrigger(s){var e;return(e=s.dialect)==null?void 0:e.showTriggers()},supportIndex(s){var e;return((e=s.dialect)==null?void 0:e.showIndex())&&![k.SNOWFLAKE,k.DATABRICKS,k.ATHENA,k.BIG_QUERY,k.PRESTO,k.TRINO].includes(s.dbType)}},actions:{updateDBType(s){this.dbType=s},updateFullInfo(s){for(const e in s)this[e]=s[e]}}}),Al={class:"design-toolbar"},Il={class:"text-center"},Dl=se({__name:"IndexPanel",setup(s){const e=B([]),t=B([]),n=B(!0),r=me(),{dbType:u,dialect:i,remainHeight:f,activePanel:c}=ge(r),y={visible:!1,loading:!1,column:null,columns:null,type:"INDEX"},E=ee({...y}),A=F(()=>{var L;return((L=E.columns)==null?void 0:L.length)>0?i.value.newIndex({...E}):""});ce(()=>{R.on("designMetaNext",()=>{E.visible=!1,t.value=i.value.indexTypes(),g()}).on("indexes",L=>{e.value=L,n.value=!1}).on("success",L=>{L=="index"&&(E.loading=!1,E.visible=!1,g())}).on("error",()=>{E.loading=!1})});const g=()=>{R.emit("indexes"),n.value=!0},h=()=>{Object.assign(E,y),E.visible=!0,E.loading=!1},I=L=>i.value.formatIndexType(L),b=()=>{E.loading=!0,R.emit("execute",{type:"index",sql:A.value})},v=L=>{Ue(d("design.deleteIndexConfirm")).then(()=>{R.emit("execute",{type:"index",sql:i.value.dropIndex(L.index_name)})})};return(L,S)=>{const z=K("vsc-button"),V=K("vsc-tooltip"),C=De,G=el,Y=Ie,q=K("RedMark"),Q=Be,te=Me,H=we,X=Le,ne=Ae,be=Ee;return m(),x("div",null,[D("div",Al,[l(V,{title:o(d)("common.new")},{default:a(()=>[["ClickHouse"].includes(o(u))?w("",!0):(m(),$(z,{key:0,type:"icon",icon:"codicon-add text-base",onClick:h}))]),_:1},8,["title"]),l(V,{title:o(d)("common.refresh")},{default:a(()=>[l(z,{type:"icon",icon:"codicon-refresh text-base",onClick:g})]),_:1},8,["title"])]),o(c)=="index"?P((m(),$(Y,{key:0,data:e.value,height:o(f),border:""},{default:a(()=>[l(C,{resizable:!0,align:"center",prop:"index_name",label:o(d)("design.indexName"),width:"200"},null,8,["label"]),l(C,{resizable:!0,align:"center",prop:"column_name",label:o(d)("design.column"),width:"200"},null,8,["label"]),l(C,{align:"center",prop:"isUnique",label:o(d)("design.unique"),width:"200"},{default:a(({row:M})=>[l(G,{disabled:"","model-value":o(Se)(M.isUnique)},null,8,["model-value"])]),_:1},8,["label"]),l(C,{resizable:!0,align:"center",prop:"index_type",label:o(d)("common.type"),width:"200"},{default:a(({row:M})=>[U(O(I(M)),1)]),_:1},8,["label"]),o(fl)(o(u))?(m(),$(C,{key:0,resizable:!0,align:"center",prop:"index_method",label:o(d)("design.indexMethod"),width:"200"},null,8,["label"])):w("",!0),["ClickHouse"].includes(o(u))?w("",!0):(m(),$(C,{key:1,label:o(d)("design.operation"),width:"120"},{default:a(({row:M})=>[D("div",Il,[l(z,{type:"icon",icon:"el-icon-delete",style:{color:"#f56c6c"},title:"delete",onClick:pe=>v(M)},null,8,["onClick"])])]),_:1},8,["label"]))]),_:1},8,["data","height"])),[[be,n.value]]):w("",!0),l(ne,{modelValue:E.visible,"onUpdate:modelValue":S[3]||(S[3]=M=>E.visible=M),"show-close":!1,title:o(d)("design.newIndex"),width:"520px",closeOnClickModal:!1,center:""},{footer:a(()=>[l(z,{type:"secondary",onClick:S[2]||(S[2]=M=>E.visible=!1)},{default:a(()=>[U(O(o(d)("common.cancel")),1)]),_:1}),l(z,{type:"primary",loading:E.loading,onClick:b},{default:a(()=>[U(O(o(d)("common.ok")),1)]),_:1},8,["loading"]),S[4]||(S[4]=D("br",null,null,-1)),S[5]||(S[5]=U()),S[6]||(S[6]=D("br",null,null,-1)),P(l(ve,{ref:"cmEditor",value:A.value,readonly:!0},null,8,["value"]),[[Z,A.value]])]),default:a(()=>[l(X,{inline:!0,"label-width":"75px",size:"small"},{default:a(()=>[l(H,null,{label:a(()=>[l(q),U(O(o(d)("design.column")),1)]),default:a(()=>[l(te,{modelValue:E.columns,"onUpdate:modelValue":S[0]||(S[0]=M=>E.columns=M),size:"small",filterable:"",multiple:"",class:"!w-[150px]"},{default:a(()=>[(m(!0),x(J,null,ae(o(r).columns,M=>(m(),$(Q,{key:M.name,label:M.name,value:M.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(H,null,{label:a(()=>[l(q),U(O(o(d)("common.type")),1)]),default:a(()=>[l(te,{modelValue:E.type,"onUpdate:modelValue":S[1]||(S[1]=M=>E.type=M),size:"small",class:"!w-[110px]"},{default:a(()=>[(m(!0),x(J,null,ae(t.value,(M,pe)=>(m(),$(Q,{key:pe,label:M.label,value:M.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}}),Ll={ref:"infoPanel",class:"design-toolbar"},wl=se({__name:"DDL",setup(s){const e=me(),t=B(!1),n=B("");ce(()=>{R.on("designMetaNext",()=>{R.emit("ddl")}).on("ddl",({ddl:u})=>{t.value=!1,n.value=u})});const r=()=>{navigator.clipboard.writeText(n.value),We("Copy DDL success!")};return(u,i)=>{const f=K("vsc-button"),c=K("vsc-tooltip"),y=Ee;return P((m(),x("div",null,[D("div",Ll,[l(c,{title:"Copy DDL"},{default:a(()=>[l(f,{type:"icon",icon:"el-icon-document-copy text-base",onClick:r})]),_:1}),l(c,{title:u.$t("common.refresh")},{default:a(()=>[l(f,{type:"icon",icon:"codicon-refresh text-base",onClick:i[0]||(i[0]=E=>o(R).emit("ddl"))})]),_:1},8,["title"])],512),o(e).activePanel=="ddl"?(m(),$(ve,{key:0,dbType:o(e).dbType,value:n.value,readonly:!0,style:bl({maxHeight:o(e).remainHeight+"px",overflow:"auto"}),class:"large"},null,8,["dbType","value","style"])):w("",!0)])),[[y,t.value]])}}}),$l={key:0,class:"design-toolbar"},Rl={class:"text-center"},kl=se({__name:"ForeignKey",setup(s){const e=me(),{dialect:t,canAlterTable:n,remainHeight:r,activePanel:u}=ge(e),i=B([]),f=B([]),c=B([]),y=B([]),E=B(!0),A=ee({visible:!1,loading:!1}),g={column:null,refTable:null,refColumn:null,foreignKeyName:null,onUpdate:"NO ACTION",onDelete:"NO ACTION"},h=ee({...g}),I=F(()=>{const{column:V,refTable:C,refColumn:G}=h;return V||C||G?t.value.newForeignKey(h):""});ce(()=>{R.on("designMetaNext",()=>{A.visible=!1,y.value=t.value.strategies(),v(),R.emit("tables")}).on("foreignKeys",V=>{E.value=!1,i.value=V}).on("columnsById",V=>{h.refColumn="",c.value=V}).on("success",V=>{V=="fk"&&(A.loading=!1,A.visible=!1,v())}).on("error",()=>{A.loading=!1}).on("tables",V=>{f.value=V})});const b=V=>{R.emit("columnsById",V)},v=()=>{const V=t.value.showForeignKeys();V&&(E.value=!0,R.emit("foreignKeys",V))},L=()=>{Object.assign(h,g),A.visible=!0,A.loading=!1},S=()=>{A.loading=!0,R.emit("execute",{type:"fk",sql:I.value})},z=V=>{Ue(d("design.deleteFkConfirm")).then(()=>{R.emit("execute",{type:"fk",sql:t.value.dropForeignKey(V.constraint_name)})})};return(V,C)=>{const G=K("vsc-button"),Y=K("vsc-tooltip"),q=De,Q=Ie,te=K("RedMark"),H=Be,X=Me,ne=we,be=Ne,M=Le,pe=Ae,Ve=Ee;return m(),x("div",null,[o(n)?(m(),x("div",$l,[l(Y,{title:o(d)("common.new")},{default:a(()=>[l(G,{type:"icon",icon:"codicon-add text-base",onClick:L})]),_:1},8,["title"]),l(Y,{title:o(d)("common.refresh")},{default:a(()=>[l(G,{type:"icon",icon:"codicon-refresh text-base",onClick:v})]),_:1},8,["title"])])):w("",!0),o(u)=="foreignKey"?P((m(),$(Q,{key:1,data:i.value,style:{width:"100%"},height:o(r),border:""},{default:a(()=>[o(n)?(m(),$(q,{key:0,resizable:!0,align:"center",prop:"constraint_name",label:o(d)("design.constraintName"),width:"150"},null,8,["label"])):w("",!0),l(q,{resizable:!0,align:"center",prop:"column_name",label:o(d)("design.column"),width:"150"},null,8,["label"]),l(q,{resizable:!0,align:"center",prop:"referenced_table",label:o(d)("design.referencedTable"),width:"150"},null,8,["label"]),l(q,{resizable:!0,align:"center",prop:"referenced_column",label:o(d)("design.referencedColumn"),width:"155"},null,8,["label"]),l(q,{align:"center",prop:"updateRule",label:o(d)("design.updateRule"),width:"150"},null,8,["label"]),l(q,{align:"center",prop:"deleteRule",label:o(d)("design.deleteRule"),width:"150"},null,8,["label"]),o(n)?(m(),$(q,{key:1,label:o(d)("design.operation"),width:"120"},{default:a(({row:N})=>[D("div",Rl,[l(G,{type:"icon",icon:"el-icon-delete",style:{color:"#f56c6c"},title:"delete",onClick:_=>z(N)},null,8,["onClick"])])]),_:1},8,["label"])):w("",!0)]),_:1},8,["data","height"])),[[Ve,E.value]]):w("",!0),l(pe,{modelValue:A.visible,"onUpdate:modelValue":C[7]||(C[7]=N=>A.visible=N),"show-close":!1,title:o(d)("design.newForeignKey"),width:"780px",closeOnClickModal:!1,"close-on-press-escape":!1,center:""},{footer:a(()=>[l(G,{type:"secondary",onClick:C[6]||(C[6]=N=>A.visible=!1)},{default:a(()=>[U(O(o(d)("common.cancel")),1)]),_:1}),l(G,{type:"primary",loading:A.loading,onClick:S},{default:a(()=>[U(O(o(d)("common.ok")),1)]),_:1},8,["loading"]),C[9]||(C[9]=D("br",null,null,-1)),C[10]||(C[10]=U()),C[11]||(C[11]=D("br",null,null,-1)),P(l(ve,{ref:"cmEditor",value:I.value,readonly:!0},null,8,["value"]),[[Z,I.value]])]),default:a(()=>[l(M,{inline:!0,"label-width":"150px","label-position":"left",size:"small"},{default:a(()=>[l(ne,null,{label:a(()=>[l(te),U(O(o(d)("design.column")),1)]),default:a(()=>[l(X,{modelValue:h.column,"onUpdate:modelValue":C[0]||(C[0]=N=>h.column=N),size:"small",filterable:"",class:"!w-[170px] mr-4"},{default:a(()=>[(m(!0),x(J,null,ae(o(e).columns,N=>(m(),$(H,{key:N.name,label:N.name,value:N.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ne,null,{label:a(()=>[U(O(o(d)("design.constraintName")),1)]),default:a(()=>[l(be,{modelValue:h.foreignKeyName,"onUpdate:modelValue":C[1]||(C[1]=N=>h.foreignKeyName=N),class:"!w-[170px]"},null,8,["modelValue"])]),_:1}),C[8]||(C[8]=D("br",null,null,-1)),l(ne,null,{label:a(()=>[l(te),U(O(o(d)("design.referencedTable")),1)]),default:a(()=>[l(X,{modelValue:h.refTable,"onUpdate:modelValue":C[2]||(C[2]=N=>h.refTable=N),size:"small",filterable:"",class:"!w-[170px] mr-4"},{default:a(()=>[(m(!0),x(J,null,ae(f.value,N=>(m(),$(H,{key:N.name,label:N.name,value:N.name,onClick:_=>b(N.id)},null,8,["label","value","onClick"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ne,null,{label:a(()=>[l(te),U(O(o(d)("design.referencedColumn")),1)]),default:a(()=>[l(X,{modelValue:h.refColumn,"onUpdate:modelValue":C[3]||(C[3]=N=>h.refColumn=N),size:"small",filterable:"",class:"!w-[170px]"},{default:a(()=>[(m(!0),x(J,null,ae(c.value,N=>(m(),$(H,{key:N.name,label:N.name,value:N.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ne,{label:"On Update"},{default:a(()=>[l(X,{modelValue:h.onUpdate,"onUpdate:modelValue":C[4]||(C[4]=N=>h.onUpdate=N),size:"small",filterable:"",class:"!w-[170px] mr-4"},{default:a(()=>[(m(!0),x(J,null,ae(y.value,N=>(m(),$(H,{key:N,label:N,value:N},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ne,{label:"On Delete"},{default:a(()=>[l(X,{modelValue:h.onDelete,"onUpdate:modelValue":C[5]||(C[5]=N=>h.onDelete=N),size:"small",filterable:"",class:"!w-[170px]"},{default:a(()=>[(m(!0),x(J,null,ae(y.value,N=>(m(),$(H,{key:N,label:N,value:N},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}}),xl={key:0,ref:"infoPanel",class:"design-toolbar"},Ol=["title"],Ul={class:"text-center"},Vl={class:"max-h-[300px] overflow-y-auto"},Sl=["onClick"],Ml=se({__name:"ColumnPanel",setup(s){const e=me(),{dbType:t,columns:n,dialect:r,canAlterTable:u,remainHeight:i,activePanel:f}=ge(e),c=ee({visible:!1,inputting:!1}),y=F(()=>r.value.columnTypes()),E=B([]),A=B(!1),g=B(!0),h=B([]),I={name:"",type:"",unsigned:null,zerofill:null,comment:null,isNotNull:null,defaultValue:null,useCurrentTimestamp:null},b=ee({...I}),v=ee({isNew:!0,editDisable:!1,editVisible:!1,editLoading:!1}),L=F(()=>{var _,T;return V.value&&((T=(_=b.type)==null?void 0:_.match)==null?void 0:T.call(_,/(\bint|decimal|float|double)/i))}),S=F(()=>{var _,T;return V.value&&((T=(_=b.type)==null?void 0:_.match)==null?void 0:T.call(_,/timestamp/i))}),z=F(()=>window.innerWidth<=1200),V=F(()=>["MySQL","Doris","MariaDB"].includes(t.value)),C=F(()=>{const _=v.isNew?"design.newColumn":"design.updateColumn";return d(_)}),G=F(()=>c.inputting&&b.type?y.value.filter(_=>(_.label||_).match(new RegExp(b.type,"i"))):y.value),Y=F(()=>{if(v.isNew){const{name:_,type:T}=b;return _&&T?r.value.newColumn(b):""}L.value||(b.zerofill=!1,b.unsigned=!1),S.value||(b.useCurrentTimestamp=!1);try{return r.value.updateColumn({newColumnName:b.name,columnType:b.type,nullable:!b.isNotNull,...b})}catch(_){return console.error(_),v.editDisable=!0,_}}),q=F(()=>[k.MYSQL,k.MARIA_DB,k.PG,k.DB2].includes(t.value));ce(()=>{R.on("designMetaNext",_=>{h.value=Ge.clone(_.columns),v.editVisible=!1,g.value=!1}).on("columns",_=>{h.value=Ge.clone(_),g.value=!1}).on("indexes",_=>{A.value=!0,E.value=_.filter(T=>Se(T.isUnique)).map(T=>T.column_name)}).on("success",_=>{_=="column"&&(v.editLoading=!1,v.editVisible=!1,X())}).on("error",()=>{v.editLoading=!1,X()})});const Q=(..._)=>!_.includes(t.value),te=_=>{_&&(b.defaultValue="CURRENT_TIMESTAMP")},H=()=>{const _=G.value[0];_&&(b.type=_.value||_,c.visible=!1)},X=()=>{R.emit("columns"),g.value=!0},ne=()=>{Object.assign(b,I),v.isNew=!0,v.editVisible=!0},be=_=>{Object.assign(b,{..._,columnName:_.name,oldRow:_}),v.isNew=!1,v.editVisible=!0,v.editDisable=!1,v.editLoading=!1},M=(_,T)=>{v.isNew=!1,Object.assign(b,{..._,columnName:_.name,oldRow:h.value[T]}),pe()},pe=()=>{if(!Y.value)return Oe("No any change!");if(v.editLoading=!0,v.isNew)return Ve();try{R.emit("execute",{type:"column",sql:Y.value})}catch(_){Oe(_.message),v.editLoading=!1}},Ve=()=>{R.emit("execute",{type:"column",sql:Y.value})},N=_=>{Ue(d("design.deleteColumnConfirm")).then(()=>{R.emit("execute",{type:"column",sql:r.value.dropColumn(_.name)})})};return(_,T)=>{const fe=K("vsc-button"),Pe=K("vsc-tooltip"),j=De,oe=el,ll=Ie,Ke=K("RedMark"),$e=Ne,re=we,tl=gl,nl=Le,ol=Ae,al=Ee;return m(),x("div",null,[o(u)?(m(),x("div",xl,[l(Pe,{title:o(d)("common.new")},{default:a(()=>[l(fe,{type:"icon",icon:"codicon-add text-base",onClick:ne})]),_:1},8,["title"]),l(Pe,{title:o(d)("common.refresh")},{default:a(()=>[l(fe,{type:"icon",icon:"codicon-refresh text-base",onClick:X})]),_:1},8,["title"])],512)):w("",!0),o(f)=="column"?P((m(),$(ll,{key:1,data:o(n),height:o(i),border:"",onRowDblclick:be},{default:a(()=>[l(j,{resizable:!0,align:"center",prop:"name",label:o(d)("common.name"),width:"180"},null,8,["label"]),l(j,{resizable:!0,align:"center",prop:"type",label:o(d)("common.type"),width:z.value?100:130},null,8,["label","width"]),l(j,{resizable:!0,align:"center",prop:"maximum_length",width:80,label:o(d)("design.length")},null,8,["label"]),["DuckDB"].includes(o(t))?w("",!0):(m(),$(j,{key:0,resizable:!0,align:"center",prop:"comment",label:o(d)("common.comment"),width:"100"},{default:a(({row:p})=>[D("span",{title:p==null?void 0:p.comment},O(p==null?void 0:p.comment),9,Ol)]),_:1},8,["label"])),l(j,{resizable:!0,align:"center",prop:"defaultValue",width:z.value?75:110,label:o(d)("common.default")},null,8,["width","label"]),l(j,{align:"center",label:"Not Null",width:80},{default:a(({row:p,$index:le})=>[l(oe,{modelValue:p.isNotNull,"onUpdate:modelValue":W=>p.isNotNull=W,onChange:W=>M(p,le)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(j,{align:"center",label:o(d)("design.isPrimary"),width:110},{default:a(({row:p})=>[l(oe,{disabled:"","model-value":p.isPrimary},null,8,["model-value"])]),_:1},8,["label"]),A.value||["MySQL","MariaDB","Doris"].includes(o(t))?(m(),$(j,{key:1,align:"center",label:o(d)("design.isUnique"),width:80},{default:a(({row:p})=>[l(oe,{disabled:"","model-value":p.isUnique||E.value.includes(p.name)},null,8,["model-value"])]),_:1},8,["label"])):w("",!0),["DuckDB"].includes(o(t))?w("",!0):(m(),$(j,{key:2,align:"center",label:o(d)("design.isAutoIncrement"),width:"130"},{default:a(({row:p,$index:le})=>[l(oe,{modelValue:p.isAutoIncrement,"onUpdate:modelValue":W=>p.isAutoIncrement=W,disabled:!p.isPrimary||!q.value,onChange:W=>M(p,le)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1},8,["label"])),["SQLite"].includes(o(t))?w("",!0):(m(),$(j,{key:3,label:o(d)("design.operation"),width:"100"},{default:a(({row:p})=>[D("div",Ul,[l(fe,{type:"icon",icon:"codicon-edit",title:"edit",onClick:le=>be(p)},null,8,["onClick"]),l(fe,{type:"icon",icon:"el-icon-delete",style:{color:"#f56c6c"},title:"delete",onClick:le=>N(p)},null,8,["onClick"])])]),_:1},8,["label"])),V.value?(m(),x(J,{key:4},[l(j,{align:"center",label:"UNSIGNED",width:"100"},{default:a(({row:p,$index:le})=>[l(oe,{modelValue:p.unsigned,"onUpdate:modelValue":W=>p.unsigned=W,"true-value":"1","false-value":"0",onChange:W=>M(p,le)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(j,{align:"center",label:"Zerofill",width:"80"},{default:a(({row:p,$index:le})=>[l(oe,{modelValue:p.zerofill,"onUpdate:modelValue":W=>p.zerofill=W,"true-value":"1","false-value":"0",onChange:W=>M(p,le)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})],64)):w("",!0)]),_:1},8,["data","height"])),[[al,g.value]]):w("",!0),l(ol,{modelValue:v.editVisible,"onUpdate:modelValue":T[12]||(T[12]=p=>v.editVisible=p),"show-close":!1,title:C.value,width:"680px",closeOnClickModal:!1,"close-on-press-escape":!1,center:""},{footer:a(()=>[l(fe,{type:"secondary",onClick:T[11]||(T[11]=p=>v.editVisible=!1)},{default:a(()=>[U(O(o(d)("common.cancel")),1)]),_:1}),l(fe,{type:"primary",loading:v.editLoading,disabled:v.editDisable,onClick:pe},{default:a(()=>[U(O(o(d)("common.ok")),1)]),_:1},8,["loading","disabled"]),T[14]||(T[14]=D("br",null,null,-1)),T[15]||(T[15]=U()),T[16]||(T[16]=D("br",null,null,-1)),P(l(ve,{ref:"cmEditor",value:Y.value,readonly:!0},null,8,["value"]),[[Z,Y.value]])]),default:a(()=>[l(nl,{inline:!0,"label-width":"90px",size:"small"},{default:a(()=>[l(re,null,{label:a(()=>[l(Ke),U(O(o(d)("common.name")),1)]),default:a(()=>[l($e,{modelValue:b.name,"onUpdate:modelValue":T[0]||(T[0]=p=>b.name=p),size:"small",fixed:""},null,8,["modelValue"])]),_:1}),L.value?(m(),$(re,{key:0,label:"ZEROFILL"},{default:a(()=>[l(oe,{modelValue:b.zerofill,"onUpdate:modelValue":T[1]||(T[1]=p=>b.zerofill=p),"true-value":"1","false-value":"0"},null,8,["modelValue"])]),_:1})):w("",!0),S.value?(m(),$(re,{key:1,label:"CURRENT_TIMESTAMP","label-width":"160px"},{default:a(()=>[l(oe,{modelValue:b.useCurrentTimestamp,"onUpdate:modelValue":T[2]||(T[2]=p=>b.useCurrentTimestamp=p),onChange:te},null,8,["modelValue"])]),_:1})):w("",!0),T[13]||(T[13]=D("br",null,null,-1)),l(re,null,{label:a(()=>[l(Ke),U(O(o(d)("common.type")),1)]),default:a(()=>[l(tl,{visible:c.visible,"onUpdate:visible":T[6]||(T[6]=p=>c.visible=p),placement:"bottom-start","popper-class":"!p-0",trigger:"click",tabindex:null},{reference:a(()=>[l($e,{modelValue:b.type,"onUpdate:modelValue":T[3]||(T[3]=p=>b.type=p),size:"small",fixed:"",onKeyup:Ce(H,["enter"]),onInput:T[4]||(T[4]=p=>{c.inputting=!0,c.visible=!0}),onClick:T[5]||(T[5]=p=>c.inputting=!1)},null,8,["modelValue"])]),default:a(()=>[D("div",Vl,[(m(!0),x(J,null,ae(G.value,(p,le)=>(m(),x(J,null,[p=="hr"?(m(),x("div",{key:le,class:"w-full type-hr bg-bg"})):(m(),x("div",{key:1,class:"el-select-dropdown__item !h-6 min-w-[190px] bg-[var(--vscode-dropdown-background)]",onClick:W=>{b.type=p.value||p,c.visible=!1}},O(p.label||p),9,Sl))],64))),256))])]),_:1},8,["visible"])]),_:1}),Q("ClickHouse")?(m(),$(re,{key:2,label:o(d)("design.isNotNull")},{default:a(()=>[l(oe,{modelValue:b.isNotNull,"onUpdate:modelValue":T[7]||(T[7]=p=>b.isNotNull=p)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),L.value?(m(),$(re,{key:3,label:"UNSIGNED"},{default:a(()=>[l(oe,{modelValue:b.unsigned,"onUpdate:modelValue":T[8]||(T[8]=p=>b.unsigned=p),"true-value":"1","false-value":"0"},null,8,["modelValue"])]),_:1})):w("",!0),!["Snowflake"].includes(o(t))||v.isNew?(m(),$(re,{key:4,label:o(d)("common.default")},{default:a(()=>[l($e,{modelValue:b.defaultValue,"onUpdate:modelValue":T[9]||(T[9]=p=>b.defaultValue=p),size:"small",fixed:""},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),["DuckDB"].includes(o(t))?w("",!0):(m(),$(re,{key:5,label:o(d)("common.comment")},{default:a(()=>[l($e,{modelValue:b.comment,"onUpdate:modelValue":T[10]||(T[10]=p=>b.comment=p),size:"small",fixed:""},null,8,["modelValue"])]),_:1},8,["label"]))]),_:1})]),_:1},8,["modelValue","title"])])}}}),Bl=Ze(Ml,[["__scopeId","data-v-ab428a54"]]),Fl={class:"ml-4"},Pl={class:"flex flex-col gap-y-2"},Kl={class:"flex-wrap"},Hl={class:"inline-block mr-5"},zl={class:"font-bold mr-5 inline-block"},Gl={class:"inline-block mr-5"},ql={class:"font-bold mr-5 inline-block"},Ql={class:"flex-wrap"},Yl={key:0,class:"inline-block mr-5"},Xl={class:"font-bold mr-5 inline-block"},jl={key:1,class:"inline-block mr-5"},Wl={class:"font-bold mr-5 inline-block"},Zl={class:"inline-block pt-1"},Jl=se({__name:"InfoPanel",setup(s){const e=me(),{dialect:t}=ge(e),n=B([]),r=ee({name:null,schema:null,newTableName:null,comment:null,newComment:null,collation:null,newCollation:null});ce(()=>{R.on("designMetaNext",i=>{r.name=i.table,r.schema=i.schema,r.newTableName=i.table,r.comment=i.comment,r.newComment=i.comment,r.collation=i.collation,r.newCollation=i.collation}).on("collations",i=>{n.value=i})});const u=()=>{const i={...r,table:r.name};R.emit("updateTable",i);const f=t.value.updateTable(i);f?R.emit("execute",{type:"table",sql:f}):Oe("No any change!")};return(i,f)=>{const c=Ne,y=Be,E=Me,A=K("vsc-button");return m(),x("div",Fl,[D("div",Pl,[D("div",Kl,[D("div",Hl,[D("label",zl,O(i.$t("design.table")),1),l(c,{modelValue:r.newTableName,"onUpdate:modelValue":f[0]||(f[0]=g=>r.newTableName=g),class:"!w-48",required:"",onKeyup:Ce(u,["enter"])},null,8,["modelValue"])]),D("div",Gl,[D("label",ql,O(i.$t("common.comment")),1),l(c,{modelValue:r.newComment,"onUpdate:modelValue":f[1]||(f[1]=g=>r.newComment=g),class:"!w-48",onKeyup:Ce(u,["enter"])},null,8,["modelValue"])])]),D("div",Ql,[o(e).tableMeta.engine?(m(),x("div",Yl,[D("label",Xl,O(i.$t("design.engine")),1),l(c,{value:o(e).tableMeta.engine,class:"!w-24",disabled:""},null,8,["value"])])):w("",!0),r.collation&&n.value.length>0?(m(),x("div",jl,[D("label",Wl,O(i.$t("design.collate")),1),l(E,{modelValue:r.newCollation,"onUpdate:modelValue":f[2]||(f[2]=g=>r.newCollation=g),size:"small",filterable:""},{default:a(()=>[(m(!0),x(J,null,ae(n.value,g=>(m(),$(y,{key:g.name,label:g.name,value:g.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):w("",!0),D("div",Zl,[l(A,{type:"success",onClick:u},{default:a(()=>[U(O(i.$t("common.update")),1)]),_:1})])])])])}}}),et={key:0,class:"design-toolbar"},lt={class:"text-center"},tt=se({__name:"Check",setup(s){const e=me(),{dialect:t,canAlterTable:n,remainHeight:r,activePanel:u}=ge(e),i=B([]),f=B(!0),c=ee({visible:!1,loading:!1}),y=ee({clause:null}),E=F(()=>y.clause?t.value.newCheck(y.clause):"");ce(()=>{R.on("designMetaNext",b=>{b.isSupportCheck&&(A(),c.visible=!1)}).on("checks",b=>{f.value=!1,i.value=b}).on("success",b=>{b=="check"&&(A(),c.visible=!1,c.loading=!1)}).on("error",()=>{c.loading=!1})});const A=()=>{const b=t.value.showChecks();if(!b){console.log("This database type does not currently support check."),f.value=!1;return}f.value=!0,R.emit("checks",b)},g=()=>{c.visible=!0,c.loading=!1,y.clause=null},h=()=>{c.loading=!0,R.emit("execute",{type:"check",sql:E.value})},I=b=>{Ue(d("design.deleteCheckConfirm")).then(()=>{R.emit("execute",{type:"check",sql:t.value.dropCheck(b.name)})})};return(b,v)=>{const L=K("vsc-button"),S=K("vsc-tooltip"),z=De,V=Ie,C=K("RedMark"),G=Ne,Y=we,q=Le,Q=Ae,te=Ee;return m(),x("div",null,[o(n)?(m(),x("div",et,[l(S,{title:o(d)("common.new")},{default:a(()=>[l(L,{type:"icon",icon:"codicon-add text-base",onClick:g})]),_:1},8,["title"]),l(S,{title:o(d)("common.refresh")},{default:a(()=>[l(L,{type:"icon",icon:"codicon-refresh text-base",onClick:A})]),_:1},8,["title"])])):w("",!0),o(u)=="check"?P((m(),$(V,{key:1,data:i.value,height:o(r),border:""},{default:a(()=>[o(n)?(m(),$(z,{key:0,resizable:!0,align:"center",prop:"name",label:o(d)("design.constraintName"),width:"200"},null,8,["label"])):w("",!0),l(z,{resizable:!0,align:"center",prop:"clause",label:o(d)("design.clause"),width:"200"},null,8,["label"]),o(n)?(m(),$(z,{key:1,label:o(d)("design.operation"),width:"100"},{default:a(({row:H})=>[D("div",lt,[l(L,{type:"icon",icon:"el-icon-delete",style:{color:"#f56c6c"},title:"delete",onClick:X=>I(H)},null,8,["onClick"])])]),_:1},8,["label"])):w("",!0)]),_:1},8,["data","height"])),[[te,f.value]]):w("",!0),l(Q,{modelValue:c.visible,"onUpdate:modelValue":v[3]||(v[3]=H=>c.visible=H),"show-close":!1,title:o(d)("design.newCheck"),width:"430px",closeOnClickModal:!1,"close-on-press-escape":!1,center:""},{footer:a(()=>[l(L,{type:"secondary",onClick:v[2]||(v[2]=H=>c.visible=!1)},{default:a(()=>[U(O(o(d)("common.cancel")),1)]),_:1}),l(L,{type:"primary",loading:c.loading,onClick:h},{default:a(()=>[U(O(o(d)("common.ok")),1)]),_:1},8,["loading"]),v[4]||(v[4]=D("br",null,null,-1)),v[5]||(v[5]=U()),v[6]||(v[6]=D("br",null,null,-1)),P(l(ve,{ref:"cmEditor",value:E.value,readonly:!0},null,8,["value"]),[[Z,E.value]])]),default:a(()=>[l(q,{inline:!0,"label-width":"80px","label-position":"left",onSubmit:v[1]||(v[1]=Je(()=>{},["prevent"])),onKeyup:Ce(h,["enter"])},{default:a(()=>[l(Y,null,{label:a(()=>[l(C),U(O(o(d)("design.clause")),1)]),default:a(()=>[l(G,{modelValue:y.clause,"onUpdate:modelValue":v[0]||(v[0]=H=>y.clause=H),class:"!w-[290px]",size:"small",placeholder:"e.g. id >20 and name!='admin'"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}}),nt={key:0,class:"design-toolbar"},ot=se({__name:"Trigger",setup(s){const e=me(),{dialect:t,canAlterTable:n,remainHeight:r,activePanel:u}=ge(e),i=B([]),f=B(!0),c=ee({visible:!1,loading:!1}),y=ee({clause:null}),E=F(()=>"");ce(()=>{R.on("designMetaNext",()=>{A(),c.visible=!1}).on("triggers",h=>{f.value=!1,i.value=h}).on("success",h=>{h=="trigger"&&(A(),c.visible=!1,c.loading=!1)}).on("error",()=>{c.loading=!1})});const A=()=>{f.value=!0,R.emit("triggers")},g=()=>{c.loading=!0,R.emit("execute",{type:"trigger",sql:E.value})};return(h,I)=>{const b=K("vsc-button"),v=K("vsc-tooltip"),L=De,S=Ie,z=K("RedMark"),V=Ne,C=we,G=Le,Y=Ae,q=Ee;return m(),x("div",null,[o(n)?(m(),x("div",nt,[l(v,{title:o(d)("common.refresh")},{default:a(()=>[l(b,{type:"icon",icon:"codicon-refresh text-base",onClick:A})]),_:1},8,["title"])])):w("",!0),o(u)=="trigger"?P((m(),$(S,{key:1,data:i.value,height:o(r),border:""},{default:a(()=>[l(L,{resizable:!0,align:"center",prop:"trigger_name",label:o(d)("design.triggerName"),width:"200"},null,8,["label"]),l(L,{resizable:!0,align:"center",prop:"timing",label:o(d)("design.timing"),width:"200"},null,8,["label"]),l(L,{resizable:!0,align:"center",prop:"manipulation",label:o(d)("design.manipulation"),width:"200"},null,8,["label"]),l(L,{resizable:!0,align:"center",prop:"orientation",label:o(d)("design.orientation"),width:"200"},null,8,["label"]),l(L,{resizable:!0,align:"center",prop:"statement",label:o(d)("design.statement"),width:"200"},{default:a(Q=>[U(O(Q.row.source||Q.row.statement),1)]),_:1},8,["label"])]),_:1},8,["data","height"])),[[q,f.value]]):w("",!0),l(Y,{modelValue:c.visible,"onUpdate:modelValue":I[3]||(I[3]=Q=>c.visible=Q),"show-close":!1,title:o(d)("design.newTrigger"),width:"430px",closeOnClickModal:!1,"close-on-press-escape":!1,center:""},{footer:a(()=>[l(b,{type:"secondary",onClick:I[2]||(I[2]=Q=>c.visible=!1)},{default:a(()=>[U(O(o(d)("common.cancel")),1)]),_:1}),l(b,{type:"primary",loading:c.loading,onClick:g},{default:a(()=>[U(O(o(d)("common.ok")),1)]),_:1},8,["loading"]),I[4]||(I[4]=D("br",null,null,-1)),I[5]||(I[5]=U()),I[6]||(I[6]=D("br",null,null,-1)),P(l(ve,{ref:"cmEditor",value:E.value,readonly:!0},null,8,["value"]),[[Z,E.value]])]),default:a(()=>[l(G,{inline:!0,"label-width":"80px","label-position":"left",onSubmit:I[1]||(I[1]=Je(()=>{},["prevent"])),onKeyup:Ce(g,["enter"])},{default:a(()=>[l(C,null,{label:a(()=>[l(z),U(O(o(d)("design.clause")),1)]),default:a(()=>[l(V,{modelValue:y.clause,"onUpdate:modelValue":I[0]||(I[0]=Q=>y.clause=Q),class:"!w-[290px]",size:"small",placeholder:"e.g. AFTER INSERT ON table_name FOR EACH ROW"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}});class ie{constructor(e){this.meta=e,this.dialect=vl(e.dbType),this.wrappedTable=ue(this.meta.table,this.meta.dbType,_l.Always)}updateTable(e){return this.dialect.updateTable(e)}columnTypes(){return["INTEGER",{label:"VARCHAR",value:"VARCHAR(255)"},{label:"CHAR",value:"CHAR(50)"},"hr","DATE","TIMESTAMP","hr","BOOLEAN","FLOAT","DOUBLE","hr","TEXT","JSON","BLOB"]}strategies(){return["RESTRICT","CASCADE","SET NULL","SET DEFAULT","NO ACTION"]}newColumn(e){const{name:t,type:n,isNotNull:r}=e,u=r?" NOT NULL":"";return`ALTER TABLE ${this.wrappedTable} ADD COLUMN ${ue(t,this.meta.dbType)} ${n}${u}`}updateColumn(e){return this.dialect.updateColumnSql({...e,table:this.meta.table,tableMeta:this.meta,schema:this.meta.schema})}dropColumn(e){return`ALTER TABLE ${this.wrappedTable} DROP COLUMN ${ue(e,this.meta.dbType)}`}formatIndexType(e){return e.index_type}indexTypes(){return[{label:"INDEX",value:"INDEX"},{label:"UNIQUE",value:"UNIQUE"}]}newIndex(e){return`ALTER TABLE ${this.wrappedTable} ADD INDEX (${e.columns.join(",")})`}dropIndex(e){return this.dialect.dropIndex(this.wrappedTable,e)}dropTrigger(e){return this.dialect.dropTriggerTemplate(e,this.wrappedTable)}showChecks(){return this.dialect.showChecks(this.meta.schema,this.meta.table)}showTriggers(){return this.dialect.showTriggers(this.meta.schema,this.meta.table)}showIndex(){return this.dialect.showIndex(this.meta.schema,this.meta.table)}showForeignKeys(){return this.dialect.showForeignKeys(this.meta.schema,this.meta.table)}newForeignKey(e){const{column:t,foreignKeyName:n,refTable:r,refColumn:u,onUpdate:i,onDelete:f}=e,c=i=="NO ACTION"?"":` ON UPDATE ${i}`,y=f=="NO ACTION"?"":` ON DELETE ${f}`;return new de(`ALTER TABLE "${this.meta.table}"`).if(n,()=>`ADD CONSTRAINT ${n}`).if(!n,"ADD").append(`FOREIGN KEY ("${t}") REFERENCES "${r}"("${u}")${c}${y};`).toString()}dropForeignKey(e){return`ALTER TABLE "${this.meta.table}" DROP CONSTRAINT ${e};`}newCheck(e){return`ALTER TABLE ${this.wrappedTable} ADD CHECK (${e});`}dropCheck(e){return`ALTER TABLE ${this.wrappedTable} DROP CONSTRAINT ${e};`}splitColumn(e,t='"'){return e.map(n=>t+n+t).join(",")}}class at extends ie{columnTypes(){return["Int32","String","Float32","hr","Date","DateTime","hr","BOOLEAN","UUID",{label:"Array",value:"Array(String)"},"hr","JSON",{label:"Tuple",value:"Tuple(String)"},{label:"Map",value:"Map(String,String)"},"hr","Int8","Int16","Int64","Int128","Int256","UInt8","UInt16","UInt32","UInt64","UInt128","UInt256","hr","DateTime64","DateTime32","hr","Decimal32","Decimal64","Decimal128","Decimal256","hr","IPv4","IPv6","hr",{label:"Enum8",value:"Enum8('a'=1)"},{label:"Enum16",value:"Enum16('a'=1)"},"hr",{label:"FixedString",value:"FixedString(100)"}]}newColumn(e){const{name:t,type:n,defaultValue:r,comment:u}=e;return new de(`ALTER TABLE ${this.wrappedTable} ADD COLUMN "${t}" ${n}`).if(!_e(r),`DEFAULT ${Te(r,n)}`).if(u,`COMMENT '${u}'`).toString()}newIndex(e){const{columns:t}=e;return`ALTER TABLE "${this.meta.table}" ADD INDEX ${t.join("")}_${new Date().getTime()}_index expression TYPE type GRANULARITY value AFTER ${this.splitColumn(t)}`}showForeignKeys(){return null}showChecks(){return null}}class Fe extends ie{newColumn(e){const{name:t,type:n,defaultValue:r,isNotNull:u}=e;return new de(`ALTER TABLE "${this.meta.schema}".${ue(this.meta.table,this.meta.dbType)} ADD ${ue(t,this.meta.dbType)} ${n}`).if(u,"NOT NULL").if(!_e(r),`DEFAULT ${Te(r,n)}`).toString()}dropColumn(e){return`ALTER TABLE "${this.meta.schema}".${this.wrappedTable} DROP COLUMN ${ue(e,this.meta.dbType)}`}newIndex(e){const{table:t=this.meta.table,columns:n,type:r}=e,u=`${t}_${n.join("_")}_${new Date().getTime()}`;return`CREATE ${r=="UNIQUE"?"UNIQUE":""} INDEX ${u} ON "${this.meta.schema}"."${t}"(${this.splitColumn(n)});`}newCheck(e){return`ALTER TABLE "${this.meta.schema}".${this.wrappedTable} ADD CHECK (${e});`}dropCheck(e){return`ALTER TABLE "${this.meta.schema}".${this.wrappedTable} DROP CONSTRAINT ${e};`}dropForeignKey(e){return`ALTER TABLE "${this.meta.schema}"."${this.meta.table}" DROP CONSTRAINT ${e};`}newForeignKey(e){return super.newForeignKey(e).replace(`"${this.meta.table}"`,`"${this.meta.schema}"."${this.meta.table}"`)}}class st extends ie{indexTypes(){return[{label:"INDEX",value:"INDEX"},{label:"UNIQUE",value:"UNIQUE"},{label:"FULLTEXT",value:"FULLTEXT"}]}columnTypes(){return["INT",{label:"VARCHAR",value:"VARCHAR(255)"},{label:"CHAR",value:"CHAR(50)"},"hr","DATETIME","TIMESTAMP","DATE","hr","BIT","FLOAT","DOUBLE",{label:"DECIMAL",value:"DECIMAL(10,2)"},"BIGINT","hr","TEXT","JSON","BLOB","BINARY","hr",{label:"ENUM",value:"ENUM('item')"},{label:"SET",value:"SET('item')"},"hr","TINYINT","SMALLINT","MEDIUMINT","hr","TIME","YEAR","hr","VARBINARY","TINYBLOB","MEDIUMBLOB","LONGBLOB","TINYTEXT","MEDIUMTEXT","LONGTEXT","hr","GEOMETRY","POINT","LINESTRING","POLYGON","MULTIPOINT","MULTILINESTRING","MULTIPOLYGON","GEOMETRYCOLLECTION"]}newColumn(e){const{name:t,type:n,comment:r,defaultValue:u,isNotNull:i,unsigned:f,zerofill:c}=e;return console.log(e),new de(`ALTER TABLE ${this.wrappedTable} ADD COLUMN \`${t}\` ${n}`).if(f&&f!=0,"UNSIGNED").if(c,"ZEROFILL").if(i,"NOT NULL").if(r,`COMMENT '${r}'`).if(!_e(u),`DEFAULT ${Te(u,n)}`).toString()}formatIndexType(e){const t=e.index_type.toUpperCase();return t=="BTREE"?e.index_name=="PRIMARY"?"PRIMARY":Se(e.isUnique)?"UNIQUE":"KEY":t}newIndex(e){const{type:t="key",columns:n}=e;return`ALTER TABLE \`${this.meta.table}\` ADD ${t} (${this.splitColumn(n,"`")})`}newForeignKey(e){const{column:t,foreignKeyName:n,refTable:r,refColumn:u,onUpdate:i,onDelete:f}=e,c=i=="NO ACTION"?"":` ON UPDATE ${i}`,y=f=="NO ACTION"?"":` ON DELETE ${f}`;return new de(`ALTER TABLE \`${this.meta.table}\``).if(n,()=>`ADD CONSTRAINT ${n}`).if(!n,"ADD").append(`FOREIGN KEY (\`${t}\`) REFERENCES \`${r}\`(\`${u}\`)${c}${y};`).toString()}dropForeignKey(e){return`ALTER TABLE \`${this.meta.table}\` DROP FOREIGN KEY ${e};`}}class it extends ie{newIndex(e){const{table:t=this.meta.table,columns:n,type:r}=e,u=`${t}_${n.join("_")}_${new Date().getTime()}`;return`CREATE ${r=="UNIQUE"?"UNIQUE":""} INDEX ${u} ON "${t}"(${this.splitColumn(n)})`}newColumn(e){const{name:t,type:n,isNotNull:r,defaultValue:u,comment:i}=e;return new de(`ALTER TABLE ${ue(this.meta.table,this.meta.dbType)} ADD ${t} ${n}`).if(!_e(u),`DEFAULT ${Te(u,n)}`).if(r,"NOT NULL").if(i,`;
COMMENT ON COLUMN ${this.wrappedTable}."${t.toUpperCase()}" is '${i}';`).toString()}newForeignKey(e){const{column:t,foreignKeyName:n,refTable:r,refColumn:u,onUpdate:i,onDelete:f}=e,c=i=="NO ACTION"?"":` ON UPDATE ${i}`,y=f=="NO ACTION"?"":` ON DELETE ${f}`,E=n||`${t}_${r}_${u}_fk_${Math.floor(Math.random()*30)}`;return`ALTER TABLE "${this.meta.table}" ADD CONSTRAINT ${E} FOREIGN KEY ("${t}") REFERENCES ${r}(${u})${c}${y};`}showForeignKeys(){var t;let{schema:e}=this.meta;return(e==null?void 0:e.toLowerCase())==((t=this.meta.user)==null?void 0:t.toLowerCase())&&(e=void 0),this.dialect.showForeignKeys(e,this.meta.table)}columnTypes(){return["INTEGER",{label:"VARCHAR2",value:"VARCHAR2(255)"},{label:"CHAR",value:"CHAR(50)"},"hr","DATE","TIMESTAMP","hr","NUMBER","FLOAT","hr","CLOB","BLOB","hr","BINARY_FLOAT","BINARY_DOUBLE","hr","TIMESTAMP WITH TIME ZONE","TIMESTAMP WITH LOCAL TIME ZONE","hr","INTERVAL YEAR TO MONTH","INTERVAL DAY TO SECOND","hr","RAW","LONG RAW","LONG","hr","NCHAR","NVARCHAR2","NCLOB","hr","BFILE","ROWID","UROWID"]}}class rt extends ie{newColumn(e){const{name:t,type:n,comment:r,defaultValue:u,isNotNull:i}=e,f=this.wrappedTable;return new de(`ALTER TABLE ${f} ADD COLUMN "${t}" ${n}`).if(i,"NOT NULL").if(!_e(u),`DEFAULT ${Te(u,n)}`).append(";").if(r,`
COMMENT ON COLUMN ${f}."${t}" is '${r}';`).toString()}columnTypes(){return["INTEGER",{label:"VARCHAR",value:"VARCHAR(255)"},{label:"CHAR",value:"CHAR(50)"},"TIMESTAMP","DATE","BOOLEAN","FLOAT","TEXT","JSON","BLOB","hr","SMALLINT","BIGINT","REAL","DOUBLE PRECISION","hr","BYTEA","XML","UUID","ARRAY","hr","NUMERIC","MONEY","INTERVAL","CIDR","INET","MACADDR"]}indexTypes(){return[{label:"INDEX",value:"INDEX"},{label:"UNIQUE",value:"UNIQUE"},{label:"HASH",value:"HASH"}]}newIndex(e){const{table:t=this.meta.table,columns:n,type:r}=e,u=r=="HASH"?"hash":"btree";return`CREATE ${r=="UNIQUE"?"UNIQUE":""} INDEX ${n.join("_")}_${new Date().getTime()}_index ON "${t}" USING ${u} (${this.splitColumn(n)});`}}class ut extends ie{newIndex(e){throw new Error("Method not implemented.")}dropForeignKey(e){return`ALTER TABLE "${this.meta.table}" DROP CONSTRAINT "${e}";`}showForeignKeys(){return`select
       rco.constraint_name "constraint_name",
       rco.UPDATE_RULE "updateRule",
       rco.DELETE_RULE "deleteRule",
       pk_tco.table_name "referenced_table"
from information_schema.referential_constraints rco
    join information_schema.table_constraints fk_tco on fk_tco.constraint_name = rco.constraint_name and fk_tco.constraint_schema = rco.constraint_schema
    join information_schema.table_constraints pk_tco on pk_tco.constraint_name = rco.unique_constraint_name and pk_tco.constraint_schema = rco.unique_constraint_schema
    WHERE fk_tco.TABLE_SCHEMA='${this.meta.schema}' and fk_tco.table_name='${this.meta.table}' 
    ORDER BY rco.CREATED`}}class dt extends ie{newIndex(e){const{table:t=this.meta.table,columns:n}=e;return`CREATE INDEX ${`${t}_${n.join("_")}_${new Date().getTime()}`} ON "${t}"(${this.splitColumn(n)});`}showForeignKeys(){return`SELECT "from" column_name, "table" referenced_table, "to" referenced_column,
        on_update, on_delete 
        FROM pragma_foreign_key_list('${this.meta.table}');`}showChecks(){return null}}class ct extends ie{newColumn(e){const{type:t,defaultValue:n}=e;return new de(super.newColumn(e)).if(!_e(n),`DEFAULT ${Te(n,t)}`).toString()}newIndex(e){const{table:t=this.meta.table,columns:n}=e;return`CREATE INDEX ${`${t}_${n.join("_")}_${new Date().getTime()}`} ON "${t}"(${this.splitColumn(n)});`}showForeignKeys(){return`SELECT constraint_column_names "column_name" FROM duckdb_constraints()
        WHERE constraint_type='FOREIGN KEY' and database_name not in ('system','temp') and schema_name='${this.meta.schema}' and table_name='${this.meta.table}'`}showChecks(){return null}}class mt extends Fe{columnTypes(){return["INTEGER",{label:"VARCHAR",value:"VARCHAR(255)"},{label:"CHAR",value:"CHAR(50)"},"hr","DATE","TIMESTAMP","TIME","hr","BOOLEAN","FLOAT","DOUBLE","hr","TEXT","BLOB","hr","SMALLINT","BIGINT","DECFLOAT","hr","TIMESTAMP WITH TIME ZONE","TIME WITH TIME ZONE","hr","XML","GRAPHIC","VARGRAPHIC","hr","DBCLOB","CLOB"]}}class pt extends Fe{columnTypes(){return["INTEGER","TEXT","hr","DATE","TIMESTAMP","hr","BOOLEAN","FLOAT","DOUBLE","hr","BLOB","hr","BIGINT","SMALLINT","TINYINT","VARINT","hr","TIME","TIMEUUID","hr","DECIMAL","COUNTER","hr","UUID","INET","ASCII","DURATION"]}dropColumn(e){return`ALTER TABLE ${this.wrappedTable} DROP ${ue(e,this.meta.dbType)}`}}function bt(s){switch(s.dbType){case k.PG:case k.REDSHIFT:case k.KINGBASE:case k.GAUSS_DB:case k.COCKROACH:return new rt(s);case k.DM:case k.ORACLE:return new it(s);case k.DB2:return new mt(s);case k.CASSANDRA:return new pt(s);case k.SQLServer:return new Fe(s);case k.SNOWFLAKE:return new ut(s);case k.CLICKHOUSE:return new at(s);case k.DUCK_DB:return new ct(s);case k.D1:case k.libSQL:case k.SQLITE:return new dt(s);case k.MYSQL:case k.MARIA_DB:case k.DATABRICKS:return new st(s);default:return new ie(s)}}const ft={class:"mt-2 design-container"},gt={id:"infoPanel"},vt={class:"tab"},_t=["onClick"],Tt={class:"design-data-container"},Et=se({__name:"design",setup(s){const e=B(!1),t=me(),n=F(()=>t.activePanel),r=F(()=>[{id:"ddl",i18n:"design.ddl",icon:"codicon-edit green"},{id:"column",i18n:"design.column",icon:"codicon-symbol-field blue"},{id:"foreignKey",i18n:"design.foreignKey",icon:"codicon-symbol-class yellow",hidden:F(()=>!t.supportForeignKey)},{id:"index",i18n:"design.index",icon:"codicon-github-action purple",hidden:F(()=>!t.supportIndex)},{id:"trigger",i18n:"design.trigger",icon:"codicon-github-action orange",hidden:F(()=>!t.supportTrigger)},{id:"check",i18n:"design.check",icon:"codicon-tools red",hidden:F(()=>!t.supportCheck||!e.value)}].filter(i=>{var f;return((f=i==null?void 0:i.hidden)==null?void 0:f.value)!=!0}));ce(()=>{R.on("dbType",i=>{t.updateDBType(i)}).on("designMeta",i=>{e.value=i.isSupportCheck,t.dialect=bt(i),t.updateFullInfo(i),R.emitImmediately("designMetaNext",i)}).on("success",()=>{We(d("design.updateSuccess"))}).on("error",i=>{Oe(i)}).on("refresh_design",()=>{u()}),u(),Tl(55,["tableTab","infoPanel"],i=>{t.remainHeight=i})});const u=()=>{R.emit("init",{type:"design"})};return(i,f)=>(m(),x("div",ft,[D("div",gt,[l(Jl),D("ul",vt,[(m(!0),x(J,null,ae(r.value,(c,y)=>(m(),x("li",{key:y,class:ze(["tab__item",{"tab__item--active":n.value==c.id}]),onClick:E=>o(t).activePanel=c.id},[c.icon?(m(),x("i",{key:0,type:"icon",class:ze(c.icon),style:{position:"relative",top:"3px"}},null,2)):w("",!0),U(" "+O(o(d)(c.i18n)),1)],10,_t))),128))])]),D("div",Tt,[P(l(wl,null,null,512),[[Z,n.value=="ddl"]]),P(l(Bl,null,null,512),[[Z,n.value=="column"]]),P(l(kl,null,null,512),[[Z,n.value=="foreignKey"]]),P(l(Dl,null,null,512),[[Z,n.value=="index"]]),P(l(ot,null,null,512),[[Z,n.value=="trigger"]]),P(l(tt,null,null,512),[[Z,n.value=="check"]])])]))}}),jt=Ze(Et,[["__scopeId","data-v-68f3d12d"]]);export{jt as default};
