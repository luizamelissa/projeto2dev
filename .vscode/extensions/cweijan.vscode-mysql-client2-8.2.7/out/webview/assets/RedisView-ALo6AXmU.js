import{s as ue,y as A,v as y,a as P,r as w,H as G,f as C,h as $,k as o,O as q,R as j,j as l,w as u,L as T,$ as z,x as Q,q as g,g as _,t as K,o as c,G as W,e as M,K as D,aD as X,ao as de,F as Y,af as ee,ak as te,D as ce,P as me,bn as pe}from"./app-eQbeWD5H.js";import{R as ve}from"./constants-Bw-uDUhc.js";import{d as Z}from"./objectUtil-Z6JRxuBJ.js";import{E as ye,u as fe}from"./dialogStore-lbPdqe9j.js";import{c as _e,s as ge,p as ke,l as he}from"./common_view_utils-CwIKtBsg.js";import{E as le,a as oe}from"./index-BaerFzpf.js";import{E as be}from"./index-BmNEnJU1.js";import{E as we,a as xe}from"./index-VRqMfdzO.js";import{E as ne,a as Ve}from"./index-Cwmhy3qH.js";import{c as Se,s as Ce}from"./codemirror-BTHjklX7.js";import"./isEqual-CLYQoJlu.js";import"./index-BOPAf95y.js";import"./index-CloKM7er.js";import"./index-CdJgEYxU.js";import"./_baseFindIndex-D7XfJLKM.js";import"./_baseIteratee-CPsVIgij.js";import"./castArray-7KkzOv2q.js";import"./merge-n0rrKiL5.js";import"./_initCloneObject-CEcXreET.js";import"./isArrayLikeObject-CFDQt_XA.js";import"./index-D9z2151g.js";import"./clone-BIcN8QqB.js";import"./_baseClone-D2nDHxTt.js";import"./DatabaseType-mO-SQkME.js";const F=ue("redis",{state:()=>({stack:!1,remainHeight:0,edit:{name:"",ttl:-1,content:null},key:{name:"",ttl:-1,content:null,count:null,type:null},itemModel:{old:null,key:null,index:null,score:null,value:null}}),actions:{saveListItem(d){if(d!=null&&(this.itemModel.value=d),!this.edit.name)return A("Key name cannot be null!");y.emit("saveItem",{...this.itemModel,keyName:this.edit.name,type:this.key.type})}}}),$e={id:"panel",class:"flex pt-2 pb-4 justify-between pr-4 flex-wrap gap-3"},ze={key:1,class:"key-label key-detail-type"},Ne=P({__name:"RedisKeyInfo",setup(d){const s=w(!1),e=F(),{key:n,edit:p}=G(e),N=()=>{Q(z("confirm.deleteRedisKey")).then(()=>{y.emit("del",{key:{name:e.key.name}}),e.key={},e.edit={}})},R=()=>{y.emit("rename",{key:{name:e.key.name,newName:e.edit.name}})},x=()=>{y.emit("ttl",{key:{name:e.key.name,ttl:e.edit.ttl}})};return y.on("new",()=>{s.value=!0}),y.on("detail",()=>{s.value=!1}),setInterval(()=>{document.activeElement.tagName!=="INPUT"&&p.value.ttl>0&&(p.value.ttl-=1)},1e3),(E,f)=>{const v=le,r=oe,m=q,k=T("vsc-button"),L=T("vsc-tooltip");return c(),C("div",$e,[$("div",null,[o(m,{ref:"keyNameInput",modelValue:l(p).name,"onUpdate:modelValue":f[1]||(f[1]=h=>l(p).name=h),size:"small",placeholder:"Please input key name",style:{width:"500px"},onKeyup:j(R,["enter"])},{prepend:u(()=>[s.value?(c(),g(r,{key:0,modelValue:l(n).type,"onUpdate:modelValue":f[0]||(f[0]=h=>l(n).type=h),placeholder:"Forever",size:"small",style:{width:"100px"}},{default:u(()=>[o(v,{value:"string",label:"STRING"}),l(e).stack?(c(),g(v,{key:0,value:"ReJSON-RL",label:"ReJSON-RL"})):_("",!0),o(v,{value:"list",label:"LIST"}),o(v,{value:"set",label:"SET"}),o(v,{value:"zset",label:"ZSET"}),o(v,{value:"hash",label:"HASH"}),o(v,{value:"stream",label:"STREAM"})]),_:1},8,["modelValue"])):(c(),C("span",ze,K(l(n).type),1))]),_:1},8,["modelValue"]),o(L,{title:l(z)("result.copy"),placement:"top"},{default:u(()=>[o(k,{class:"ml-1",size:"mini",icon:"el-icon-document-copy",onClick:f[2]||(f[2]=h=>l(_e)(l(p).name))})]),_:1},8,["title"])]),$("div",null,[o(m,{modelValue:l(p).ttl,"onUpdate:modelValue":f[3]||(f[3]=h=>l(p).ttl=h),size:"small",class:"mr-1",style:{width:"220px"},onKeyup:j(x,["enter"])},{prepend:u(()=>f[4]||(f[4]=[$("span",{class:"key-label"},"TTL",-1)])),_:1},8,["modelValue"]),o(k,{icon:"codicon codicon-save",size:"mini",onClick:x}),o(k,{icon:"el-icon-delete",size:"mini",type:"secondary",onClick:N})])])}}}),Re=W(Ne,[["__scopeId","data-v-ae794ec1"]]),Ee={key:0},Ie={id:"listPanel"},Te=["title","textContent"],Le=P({__name:"RedisListView",setup(d){const s=F(),{key:e,itemModel:n,remainHeight:p}=G(s),N=w(""),R=w(""),x=w(1),E=w(100),f=w(0),v=w(!1);y.on("detail",i=>{v.value=!1,x.value=i.page.pageNum,E.value=i.page.pageSize}).on("pagination",i=>{s.key.content=i}).on("success",()=>{v.value=!1});const r=M(()=>{const i=s.itemModel.old;let t=e.value.type;return t=t.charAt(0).toUpperCase()+t.slice(1),`${i?"Edit":"Add to"} ${t}`}),m=M(()=>{const i=e.value.type;switch(i){case"list":return"Element";case"hash":return"Value";case"set":case"zset":return"Member";case"stream":return"Entry";default:return i.charAt(0).toUpperCase()+i.slice(1)}}),k=(i,t)=>{y.emit("changePage",t?i:x.value+i)},L=()=>{v.value=!0,s.itemModel={old:null,key:null,index:null,score:null,value:null}},h=M(()=>{e.value.content||(e.value.content=[]);const i=N.value,t=R.value,S=e.value.content.filter(b=>!(i&&e.value.type=="hash"&&!`${b.key}`.match(new RegExp(i,"i"))||t&&!`${b.value??b}`.match(new RegExp(t,"i"))));return f.value=e.value.count??S.length,S}),J=i=>{Q(z("confirm.deleteRedisKey")).then(()=>{y.emit("deleteLine",i)})},H=i=>{navigator.clipboard.writeText(i.value??i),X(z("common.copied"))},V=i=>{s.itemModel={...i,old:{...i}},v.value=!0};return(i,t)=>{const S=q,b=T("vsc-button"),B=T("vsc-tooltip"),ae=ye,O=Ve,se=ne,ie=be,I=xe,re=we;return["list","hash","set","zset","stream"].includes(l(e).type)?(c(),C("div",Ee,[$("div",Ie,[l(e).type=="hash"?(c(),g(S,{key:0,modelValue:N.value,"onUpdate:modelValue":t[0]||(t[0]=a=>N.value=a),class:"filter-input mb-2 mr-2",size:"small",style:{width:"120px"},placeholder:l(z)("result.searchField"),clearable:!0},null,8,["modelValue","placeholder"])):_("",!0),o(S,{modelValue:R.value,"onUpdate:modelValue":t[1]||(t[1]=a=>R.value=a),class:"filter-input mb-2",size:"small",style:{width:"200px"},placeholder:l(z)("result.searchNotice"),clearable:!0},null,8,["modelValue","placeholder"]),o(B,{title:l(z)("common.refresh"),placement:"top"},{default:u(()=>[o(b,{type:"icon",icon:"codicon-refresh text-lg",class:"ml-2",onClick:t[2]||(t[2]=a=>{l(y).emit("refresh")})})]),_:1},8,["title"]),o(B,{title:"Add new key"},{default:u(()=>[l(e).type!="stream"?(c(),g(b,{key:0,type:"icon",icon:"codicon-add text-lg",class:"inline-block !ml-1",style:{color:"var(--vscode-terminal-ansiYellow)"},onClick:t[3]||(t[3]=a=>L())})):_("",!0)]),_:1}),o(ae,{"page-size":E.value,"onUpdate:pageSize":t[4]||(t[4]=a=>E.value=a),"current-page":x.value,"onUpdate:currentPage":t[5]||(t[5]=a=>x.value=a),small:!0,total:f.value,"page-sizes":[20,50,100,200,300],layout:"prev,pager, next, total",onCurrentChange:t[6]||(t[6]=a=>k(a,!0)),onNextClick:t[7]||(t[7]=()=>k(1)),onPrevClick:t[8]||(t[8]=()=>k(-1))},null,8,["page-size","current-page","total"]),o(ie,{modelValue:v.value,"onUpdate:modelValue":t[15]||(t[15]=a=>v.value=a),"show-close":!1,title:r.value,closeOnClickModal:!1,"close-on-press-escape":!1,width:"30%",class:"new-item-dialog"},{footer:u(()=>[o(b,{type:"secondary",onClick:t[13]||(t[13]=a=>v.value=!1)},{default:u(()=>[D(K(l(z)("common.cancel")),1)]),_:1}),o(b,{type:"primary",onClick:t[14]||(t[14]=a=>l(s).saveListItem())},{default:u(()=>t[16]||(t[16]=[D("Confirm")])),_:1})]),default:u(()=>[o(se,{"label-width":"60px"},{default:u(()=>[l(e).type=="list"?(c(),g(O,{key:0,label:"Index"},{default:u(()=>[o(S,{modelValue:l(n).index,"onUpdate:modelValue":t[9]||(t[9]=a=>l(n).index=a),size:"small",disabled:""},null,8,["modelValue"])]),_:1})):_("",!0),l(e).type=="hash"?(c(),g(O,{key:1,label:"Field"},{default:u(()=>[o(S,{modelValue:l(n).key,"onUpdate:modelValue":t[10]||(t[10]=a=>l(n).key=a),size:"small"},null,8,["modelValue"])]),_:1})):_("",!0),l(e).type=="zset"?(c(),g(O,{key:2,label:"Score"},{default:u(()=>[o(S,{modelValue:l(n).score,"onUpdate:modelValue":t[11]||(t[11]=a=>l(n).score=a),size:"small"},null,8,["modelValue"])]),_:1})):_("",!0),o(O,{label:m.value},{default:u(()=>[o(S,{modelValue:l(n).value,"onUpdate:modelValue":t[12]||(t[12]=a=>l(n).value=a),size:"small"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])]),$("div",null,[o(re,{data:h.value,height:l(p),border:""},{default:u(()=>[l(e).type=="list"?(c(),g(I,{key:0,label:"Index",prop:"index",sortable:"",width:"90",align:"center"})):_("",!0),l(e).type=="hash"?(c(),g(I,{key:1,"sort-by":"key",resizable:"",sortable:"",label:"Field",align:"center",width:"200",prop:"key"})):_("",!0),l(e).type=="zset"?(c(),g(I,{key:2,"sort-by":"score",resizable:"",sortable:"",label:"Score",align:"center",width:"200",prop:"score"})):_("",!0),l(e).type=="stream"?(c(),g(I,{key:3,"sort-by":"id",resizable:"",sortable:"",label:"id",align:"center",width:"200",prop:"id"})):_("",!0),o(I,{"sort-by":"value",resizable:"",sortable:"",label:m.value,align:"center"},{default:u(a=>{var U;return[$("span",{class:"item-value",title:a.row.value,textContent:K(((U=a.row)==null?void 0:U.value)||a.row)},null,8,Te)]}),_:1},8,["label"]),o(I,{label:"Operation",width:"150",align:"center"},{default:u(a=>[o(b,{type:"icon",icon:"codicon-copy",title:"View On Dialog",onClick:U=>{H(a.row)}},null,8,["onClick"]),["list","hash","set","zset"].includes(l(e).type)?(c(),g(b,{key:0,type:"icon",icon:"codicon-edit text-base",title:"edit",style:{color:"var(--vscode-terminal-ansiYellow)"},onClick:U=>V(a.row)},null,8,["onClick"])):_("",!0),o(b,{class:"ml-3",type:"icon",icon:"el-icon-delete text-base",style:{color:"#f56c6c"},title:"delete",onClick:U=>J(a.row)},null,8,["onClick"])]),_:1})]),_:1},8,["data","height"])])])):_("",!0)}}});function Ue(d){if(d==null)return"";if(!Number.isFinite(d)&&(d=parseInt(d),!Number.isFinite(d)))return`${d}`;const s=d<0;s&&(d=-d);const e=["B","K","M","G","T","P","E","Z","Y"];if(d<1)return`${s?"-":""}${d} ${e[0]}`;const n=Math.min(Math.floor(Math.log(d)/Math.log(1024)),e.length-1);d=d/1024**n;const p=Number(d.toPrecision(3));return`${s?"-":""}${p}${e[n]}`}const Me={key:0,id:"stringPanel",class:"flex pr-4 mb-2 gap-x-3 items-center ml-1"},Ke={key:0,class:"flex"},Oe={class:"value-panel"},De=P({__name:"RedisStringView",setup(d){const s=F(),{key:e}=G(s),n=w(""),p=w("Text"),N=w(Ce),R=M(()=>{var r;return Ue(((r=n.value)==null?void 0:r.length)||0)}),x=M(()=>["string","ReJSON-RL"].includes(s.key.type));window.addEventListener("keydown",r=>{x.value&&de(r)&&r.code=="KeyS"&&E()});const E=()=>{if(!s.edit.name)return A("Key name cannot be null!");y.emit("update",{key:{name:s.key.name,newName:s.edit.name,type:s.key.type,ttl:s.edit.ttl,content:n.value}})};y.on("detailNext",()=>{f()});const f=()=>{if(!x.value)return n.value="";const r=s.edit.content,m=(r==null?void 0:r.match(/^\s*[{[]/))!=null;p.value=m?"JSON":"Text",m?v(r):n.value=r},v=r=>{var m;try{n.value=ge(ke((m=r==null?void 0:r.replace)==null?void 0:m.call(r,/ /g," ")),null,2)}catch(k){console.error(k),n.value=r}};return(r,m)=>{const k=le,L=oe,h=T("vsc-button"),J=T("vsc-tooltip"),H=ne;return c(),C(Y,null,[["string","ReJSON-RL"].includes(l(e).type)?(c(),C("div",Me,[$("div",null," Size: "+K(R.value),1),["string","ReJSON-RL"].includes(l(e).type)?(c(),C("div",Ke,[o(L,{modelValue:p.value,"onUpdate:modelValue":m[0]||(m[0]=V=>p.value=V),placeholder:"Default",size:"small",style:{width:"145px"},class:"mr-2"},{default:u(()=>[(c(!0),C(Y,null,ce(N.value,V=>(c(),g(k,{key:V,value:V},{default:u(()=>[D(K(V),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),o(J,{title:r.$t("common.refresh"),placement:"top"},{default:u(()=>[o(h,{type:"secondary",size:"micro",icon:"codicon-refresh",onClick:m[1]||(m[1]=V=>{l(y).emit("refresh")})})]),_:1},8,["title"]),o(h,{icon:"codicon codicon-save",style:{height:"27px"},onClick:E},{default:u(()=>m[3]||(m[3]=[D("Save")])),_:1})])):_("",!0)])):_("",!0),ee(o(H,null,{default:u(()=>[$("div",Oe,[o(Se,{ref:"cmEditor",value:n.value,"onUpdate:value":m[2]||(m[2]=V=>n.value=V),language:p.value,class:"json-panel",style:me("height:"+l(s).remainHeight+"px")},null,8,["value","language","style"])])]),_:1},512),[[te,["string","ReJSON-RL"].includes(l(e).type)]])],64)}}}),Pe=W(De,[["__scopeId","data-v-1ea839f2"]]),Fe={class:"redis-view-container"},Je={key:0,style:{"text-align":"center"}},He={class:"mx-2"},vt=P({__name:"RedisView",setup(d){const s=w(!0),e=F();return fe(),pe(()=>{he(100,[],n=>{e.remainHeight=n}),y.on("new",({prefix:n,stack:p})=>{s.value=!1,e.stack=p,e.key={name:n,type:ve.STRING,ttl:-1},e.edit=Z(e.key)}).on("detail",n=>{s.value=!1,e.key=n.res,e.edit=Z(n.res),y.emitImmediately("detailNext")}).on("error",n=>{A(n)}).on("success",n=>{X(n)}),y.emit("init")}),(n,p)=>(c(),C("div",Fe,[s.value?(c(),C("div",Je," loading ")):_("",!0),ee($("div",He,[o(Re),o(Le),o(Pe)],512),[[te,!s.value]])]))}});export{vt as default};
